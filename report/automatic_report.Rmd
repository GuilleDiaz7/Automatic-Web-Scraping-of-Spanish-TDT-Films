---
title: "Spanish TDT movies report"
author: "Guillermo Diaz"
date: "`r Sys.Date()`"
output:
  pdf_document:
    toc: yes
    toc_depth: '2'
  html_document:
    toc: true
    toc_float: true
    toc_align: "left"
    toc_depth: 2
    theme: "yeti"
lang: "es-ES"
---

# INTRODUCTION

[Link](https://github.com/GuilleDiaz7)

This line of code is quite magical. Change any opts_chunk here and it will change the entire document. You can set any option you want: `echo`, `include`, `warning` or `messages`.

```{r setup}
#| include = TRUE
knitr::opts_chunk$set(
	echo = TRUE,
	message = FALSE,
	warning = FALSE
)
```

# LOAD AND CLEAN DATA

```{r Load and prepare data}
#| warning = FALSE,
#| include = FALSE,
#| messages = FALSE
library(dplyr)
library(tidyr)


data <- read.csv("https://raw.githubusercontent.com/GuilleDiaz7/Automatic-Web-Scraping-of-Spanish-TDT-Films/main/data/pelis_tv_hoy.csv", fileEncoding = 'UTF-8')

df <- data %>% mutate(
  genre = replace(genre, genre == "Suspense / Thriller", "Suspense"),
  genre = replace(genre, genre == "Documentales", "Documental"),
  genre = replace(genre, genre == "Ciencia ficci?n", "SyFy"),
  genre = replace(genre, genre == "Infantil/Familiar", "Infantil")
)
```

The data set contains `r nrow(df)` instances and `r ncol(df)` variables. From now on, we won't be using the variable `Description`, which included a brief synopsis of each film. Let's see a few examples of the data.

```{r}
#| warning = FALSE
library(knitr)
df_no_desc <- df %>% 
  select(1:8)

df_no_desc %>% 
  head(6) %>% 
  knitr::kable()
```

The variables names are formatted to work with them in R, not to be shown in a document. We can clean them.


```{r}
df_clean <- df_no_desc %>% 
  dplyr::rename(
    Date = date_time,
    Channel = channel,
    "Spanish title" = sp_title,
    "Original title" = original_title,
    Year = year,
    Genre = genre,
    Country = country,
    Length = length
  )

df_clean %>% 
  head() %>% 
  knitr::kable()
```

This is so much better. I want to see some examples with `Country` and `Length` data.

```{r}
df_clean %>% 
  drop_na() %>%
  head() %>% 
  knitr::kable()
```

I don't like to see the unit in the `Length` column. I noticed to that film genres are in spanish. Let's clean both columns.

```{r}

```


¿How many unique values there are in each variable?

```{r distinct values}
library(purrr)
df %>% map_dbl(
  n_distinct
)
```

So, if there are `r nrow(df)` instances, why do we only have `r n_distinct(df$sp_title)` movies? I guess some of them were broadcasted more than once. These are the ones:

```{r}
df_clean %>% 
  group_by(`Spanish title`) %>% 
  summarise(emisiones = n()) %>% 
  filter(emisiones > 1)

```

# MAPPING THE DATA

First, we have to prepare the data. Country names are in spanish, let's translate them.

```{r}
df_map <- df_clean %>% 
  group_by(`Country`) %>% 
  summarise(Movies = n())

df_map <- df_map %>% 
  mutate(
    Country = case_when(
      Country == "Alemania" ~ "Germany",
      Country == "Canadá" ~ "Canada",
      Country == "España" ~ "Spain",
      Country == "Estados Unidos" ~ "United States",
      Country == "Italia" ~ "Italy",
      Country == "Reino Unido" ~ "England"
    )
  )
df_map
```
Then, we plot a map

```{r}
library(ggplot2)
library(sf)
library(rnaturalearth)

world <- ne_countries(scale = "small", returnclass = "sf")

world %>% 
  ggplot() + 
  geom_sf() +
  geom_hline(yintercept = 0, linetype = "dashed") 

```
The latter was an empty world map. We are goint to fill it with our data. We create a suitable data frame.

```{r}
world <- world %>% 
  dplyr::rename("Country" = "sovereignt")

prueba <- left_join(world, df_map)

```

Let's see how it looks filled.

```{r}
library(ggplot2)
library(sf)
prueba %>% 
  ggplot() +
  geom_sf(aes(fill = Movies)) +
  theme_void() +
  theme(legend.position = "top") +
  labs(fill = "Number of movies:") +
  guides(fill = guide_legend(nrow = 2, byrow = TRUE))
```



Con `results = 'hold'` lo que hacemos es sacar todos los resultados del tirón, sin partir el cuadro de código cada vez que hay un resultado que mostrar[^1].




[^1]: Me marco un pie de página absolutamente escandaloso.

```{r}
#| results = 'hold'
data(iris)
a <- 1+1
print(a)
head(iris)
```

Note that the **echo = FALSE** parameter was added to the code chunk to prevent printing of the R code that generated the plot.

```{r}
#| echo = FALSE
plot(iris$Sepal.Length, iris$Sepal.Width)

```

```{r}
#| eval = FALSE
plot(iris$Sepal.Length, iris$Sepal.Width)
```

```{r}
#| warning = FALSE
data("HairEyeColor")
chisq.test(HairEyeColor[, , 2])
```

```{r}
#| message = FALSE,
#| warning = FALSE
library(vcd)

```

¡Cuidado con el nombre de las variables!

```{r}
#| error = TRUE,
#| eval = FALSE
library(ggplot2)
data(iris)

ggplot(iris, aes(Sepal.Width, Sepal.Legth)) +
  geom_point()
```

------------------------------------------------------------------------

# Real Stuff with TDT data

```{r}
#| warnings = FALSE
df <- read.csv("https://raw.githubusercontent.com/GuilleDiaz7/Automatic-Web-Scraping-of-Spanish-TDT-Films/main/data/pelis_tv_hoy.csv",
               fileEncoding = "UTF-8")
library(tidyr)
df_clean <- df %>% 
  drop_na()
library(dplyr)
head(
  df_clean %>% select(
  1:8
  )
)

```

Para crear *listas*:

-   Un elemento
-   Otro elemento
    -   Otro elemento más

1.  Elemento 1
2.  Elemento 2
3.  Elemento 3

# Create tables the handy way

```{r penguins_table}
#| eval = FALSE,
#| warning = FALSE
library(palmerpenguins)
penguins %>% 
  head() %>% 
  knitr::kable()
```

# Para escribir una cita en bloque

> Cara antigua. Es **code block** en la opción *Format* del Editor Visual.
